# å·¥å…·è°ƒç”¨

```{=mdx}
:::ğŸ—’ï¸
æˆ‘ä»¬å°†æœ¯è¯­å·¥å…·è°ƒç”¨ä¸å‡½æ•°è°ƒç”¨è§†ä¸ºåŒä¹‰è¯ã€‚è™½ç„¶å‡½æ•°è°ƒç”¨æœ‰æ—¶æŒ‡çš„æ˜¯å¯¹å•ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œ
ä½†æˆ‘ä»¬å°†æ‰€æœ‰æ¨¡å‹éƒ½è§†ä¸ºå¯ä»¥åœ¨æ¯ä¸ªæ¶ˆæ¯ä¸­è¿”å›å¤šä¸ªå·¥å…·æˆ–å‡½æ•°è°ƒç”¨ã€‚
:::
```

å·¥å…·è°ƒç”¨å…è®¸æ¨¡å‹é€šè¿‡ç”Ÿæˆä¸ç”¨æˆ·å®šä¹‰çš„æ¨¡å¼åŒ¹é…çš„è¾“å‡ºæ¥å“åº”ç»™å®šçš„æç¤ºã€‚è™½ç„¶åç§°æš—ç¤ºæ¨¡å‹æ­£åœ¨æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼æ¨¡å‹æ­£åœ¨æå‡ºä¸€ä¸ªå·¥å…·çš„å‚æ•°ï¼Œå®é™…ä¸Šè¿è¡Œå·¥å…·ï¼ˆæˆ–ä¸è¿è¡Œï¼‰å–å†³äºç”¨æˆ· - ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦ä»éç»“æ„åŒ–æ–‡æœ¬ä¸­[æå–ä¸æŸä¸ªæ¨¡å¼åŒ¹é…çš„è¾“å‡º](/use_cases/extraction/)ï¼Œæ‚¨å¯ä»¥ç»™æ¨¡å‹ä¸€ä¸ª"æå–"å·¥å…·ï¼Œè¯¥å·¥å…·æ¥å—ä¸æ‰€éœ€æ¨¡å¼åŒ¹é…çš„å‚æ•°ï¼Œç„¶åå°†ç”Ÿæˆçš„è¾“å‡ºè§†ä¸ºæœ€ç»ˆç»“æœã€‚

å·¥å…·è°ƒç”¨åŒ…æ‹¬åç§°ã€å‚æ•°å­—å…¸å’Œå¯é€‰æ ‡è¯†ç¬¦ã€‚å‚æ•°å­—å…¸çš„ç»“æ„ä¸º`{å‚æ•°å: å‚æ•°å€¼}`ã€‚

è®¸å¤šLLMæä¾›è€…ï¼ŒåŒ…æ‹¬[Anthropic](https://www.anthropic.com/)ã€
[Cohere](https://cohere.com/)ã€[Google](https://cloud.google.com/vertex-ai)ã€
[Mistral](https://mistral.ai/)ã€[OpenAI](https://openai.com/)ç­‰ï¼Œ
éƒ½æ”¯æŒå·¥å…·è°ƒç”¨åŠŸèƒ½çš„å˜ä½“ã€‚è¿™äº›åŠŸèƒ½é€šå¸¸å…è®¸LLMçš„è¯·æ±‚åŒ…æ‹¬å¯ç”¨å·¥å…·åŠå…¶æ¨¡å¼ï¼Œå¹¶ä¸”å“åº”ä¸­åŒ…å«å¯¹è¿™äº›å·¥å…·çš„è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªæœç´¢å¼•æ“å·¥å…·ï¼ŒLLMå¯ä»¥é€šè¿‡é¦–å…ˆå‘å‡ºå¯¹æœç´¢å¼•æ“çš„è°ƒç”¨æ¥å¤„ç†æŸ¥è¯¢ã€‚è°ƒç”¨LLMçš„ç³»ç»Ÿå¯ä»¥æ¥æ”¶å·¥å…·è°ƒç”¨ï¼Œæ‰§è¡Œå®ƒï¼Œå¹¶å°†è¾“å‡ºè¿”å›ç»™LLMä»¥é€šçŸ¥å…¶å“åº”ã€‚LangChainåŒ…æ‹¬ä¸€å¥—[å†…ç½®å·¥å…·](/docs/integrations/tools/)ï¼Œå¹¶æ”¯æŒå‡ ç§å®šä¹‰è‡ªå·±çš„[è‡ªå®šä¹‰å·¥å…·](/modules/tools/custom_tools)çš„æ–¹æ³•ã€‚å·¥å…·è°ƒç”¨å¯¹äºæ„å»º[ä½¿ç”¨å·¥å…·çš„é“¾å’Œä»£ç†](/use_cases/tool_use)ä»¥åŠä»æ¨¡å‹è·å–ç»“æ„åŒ–è¾“å‡ºéå¸¸æœ‰ç”¨ã€‚

ä¸åŒçš„ä¾›åº”å•†å¯¹äºå·¥å…·æ¨¡å¼å’Œå·¥å…·è°ƒç”¨çš„æ ¼å¼é‡‡ç”¨äº†ä¸åŒçš„çº¦å®šã€‚ä¾‹å¦‚ï¼ŒAnthropicå°†å·¥å…·è°ƒç”¨ä½œä¸ºè§£æç»“æ„è¿”å›åˆ°è¾ƒå¤§å†…å®¹å—ä¸­ï¼š
```python
[
  {
    "text": "<thinking>\nI should use a tool.\n</thinking>",
    "type": "text"
  },
  {
    "id": "id_value",
    "input": {"arg_name": "arg_value"},
    "name": "tool_name",
    "type": "tool_use"
  }
]
```
è€ŒOpenAIå°†å·¥å…·è°ƒç”¨åˆ†ç¦»ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‚æ•°ï¼Œå‚æ•°ä¸ºJSONå­—ç¬¦ä¸²ï¼š
```python
{
  "tool_calls": [
    {
      "id": "id_value",
      "function": {
        "arguments": '{"arg_name": "arg_value"}',
        "name": "tool_name"
      },
      "type": "function"
    }
  ]
}
```
LangChainå®ç°äº†å®šä¹‰å·¥å…·çš„æ ‡å‡†æ¥å£ï¼Œå°†å®ƒä»¬ä¼ é€’ç»™LLMï¼Œå¹¶è¡¨ç¤ºå·¥å…·è°ƒç”¨ã€‚

## å°†å·¥å…·ä¼ é€’ç»™LLM

æ”¯æŒå·¥å…·è°ƒç”¨åŠŸèƒ½çš„èŠå¤©æ¨¡å‹å®ç°äº†`.bind_tools`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶LangChain [å·¥å…·å¯¹è±¡](https://api.python.langchain.com/en/latest/tools/langchain_core.tools.BaseTool.html#langchain_core.tools.BaseTool)åˆ—è¡¨ï¼Œå¹¶å°†å®ƒä»¬ç»‘å®šåˆ°èŠå¤©æ¨¡å‹ä¸­ä»¥ç¬¦åˆé¢„æœŸçš„æ ¼å¼ã€‚å¯¹èŠå¤©æ¨¡å‹çš„åç»­è°ƒç”¨å°†åœ¨å…¶è°ƒç”¨LLMæ—¶åŒ…å«å·¥å…·æ¨¡å¼ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pythonå‡½æ•°ä½¿ç”¨`@tool`è£…é¥°å™¨å®šä¹‰è‡ªå®šä¹‰å·¥å…·çš„æ¨¡å¼ï¼š

```python
from langchain_core.tools import tool


@tool
def add(a: int, b: int) -> int:
    """å°†aå’Œbç›¸åŠ ã€‚"""
    return a + b


@tool
def multiply(a: int, b: int) -> int:
    """å°†aå’Œbç›¸ä¹˜ã€‚"""
    return a * b


tools = [add, multiply]
```

æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Pydanticå®šä¹‰æ¨¡å¼ï¼š

```python
from langchain_core.pydantic_v1 import BaseModel, Field


# æ³¨æ„ï¼Œè¿™é‡Œçš„æ–‡æ¡£å­—ç¬¦ä¸²éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å°†ä¸ç±»åä¸€èµ·ä¼ é€’ç»™æ¨¡å‹ã€‚
class Add(BaseModel):
    """å°†ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ã€‚"""

    a: int = Field(..., description="ç¬¬ä¸€ä¸ªæ•´æ•°")
    b: int = Field(..., description="ç¬¬äºŒä¸ªæ•´æ•°")


class Multiply(BaseModel):
    """å°†ä¸¤ä¸ªæ•´æ•°ç›¸ä¹˜ã€‚"""

    a: int = Field(..., description="ç¬¬ä¸€ä¸ªæ•´æ•°")
    b: int = Field(..., description="ç¬¬äºŒä¸ªæ•´æ•°")


tools = [Add, Multiply]
```

æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç»‘å®šåˆ°èŠå¤©æ¨¡å‹ï¼š

```{=mdx}
import ChatModelTabs from "@theme/ChatModelTabs";

<ChatModelTabs
  customVarName="llm"
  fireworksParams={`model="accounts/fireworks/models/firefunction-v1", temperature=0`}
/>
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`bind_tools()`æ–¹æ³•æ¥å¤„ç†å°†`Multiply`è½¬æ¢ä¸º"tool"å¹¶å°†å…¶ç»‘å®šåˆ°æ¨¡å‹ï¼ˆå³æ¯æ¬¡è°ƒç”¨æ¨¡å‹æ—¶ä¼ é€’å®ƒï¼‰ã€‚

```python
# | echo: false
# | output: false

from langchain_openai import ChatOpenAI

llm = ChatOpenAI(model="gpt-3.5-turbo-0125", temperature=0)
```


```python
llm_with_tools = llm.bind_tools(tools)
```

## å·¥å…·è°ƒç”¨

å¦‚æœå·¥å…·è°ƒç”¨åŒ…å«åœ¨LLMå“åº”ä¸­ï¼Œå®ƒä»¬å°†ä½œä¸º[æ¶ˆæ¯](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.ai.AIMessage.html#langchain_core.messages.ai.AIMessage) 
æˆ–[æ¶ˆæ¯å—](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.ai.AIMessageChunk.html#langchain_core.messages.ai.AIMessageChunk)çš„å±æ€§`.tool_calls`ä¸­çš„[å·¥å…·è°ƒç”¨](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.tool.ToolCall.html#langchain_core.messages.tool.ToolCall)å¯¹è±¡çš„åˆ—è¡¨é™„åŠ åˆ°ç›¸åº”çš„æ¶ˆæ¯æˆ–æ¶ˆæ¯å—ä¸Šã€‚`ToolCall`æ˜¯ä¸€ä¸ªç±»å‹åŒ–çš„å­—å…¸ï¼Œå…¶ä¸­åŒ…æ‹¬å·¥å…·åç§°ã€å‚æ•°å€¼å­—å…¸å’Œï¼ˆå¯é€‰ï¼‰æ ‡è¯†ç¬¦ã€‚æ²¡æœ‰å·¥å…·è°ƒç”¨çš„æ¶ˆæ¯é»˜è®¤å°†è¯¥å±æ€§è®¾ç½®ä¸ºç©ºåˆ—è¡¨ã€‚

ç¤ºä¾‹ï¼š

```python
query = "3 * 12æ˜¯å¤šå°‘ï¼Ÿæ­¤å¤–ï¼Œ11 + 49æ˜¯å¤šå°‘ï¼Ÿ"

llm_with_tools.invoke(query).tool_calls
```




    [{'name': 'Multiply',
      'args': {'a': 3, 'b': 12},
      'id': 'call_1Tdp5wUXbYQzpkBoagGXqUTo'},
     {'name': 'Add',
      'args': {'a': 11, 'b': 49},
      'id': 'call_k9v09vYioS3X0Qg35zESuUKI'}]



`.tool_calls`å±æ€§åº”åŒ…å«æœ‰æ•ˆçš„å·¥å…·è°ƒç”¨ã€‚è¯·æ³¨æ„ï¼Œæœ‰æ—¶æ¨¡å‹æä¾›è€…å¯èƒ½ä¼šè¾“å‡ºæ ¼å¼ä¸æ­£ç¡®çš„å·¥å…·è°ƒç”¨ï¼ˆä¾‹å¦‚ï¼Œæ— æ•ˆçš„JSONå‚æ•°ï¼‰ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè§£æå¤±è´¥æ—¶ï¼Œå°†åœ¨`.invalid_tool_calls`å±æ€§ä¸­å¡«å……[InvalidToolCall](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.tool.InvalidToolCall.html#langchain_core.messages.tool.InvalidToolCall)çš„å®ä¾‹ã€‚InvalidToolCallå¯ä»¥å…·æœ‰åç§°ã€å­—ç¬¦ä¸²å‚æ•°ã€æ ‡è¯†ç¬¦å’Œé”™è¯¯æ¶ˆæ¯ã€‚

å¦‚æœéœ€è¦ï¼Œ[è¾“å‡ºè§£æå™¨](/modules/model_io/output_parsers)å¯ä»¥è¿›ä¸€æ­¥å¤„ç†è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è½¬æ¢å›åŸå§‹çš„Pydanticç±»ï¼š

```python
from langchain_core.output_parsers.openai_tools import PydanticToolsParser

chain = llm_with_tools | PydanticToolsParser(tools=[Multiply, Add])
chain.invoke(query)
```




    [Multiply(a=3, b=12), Add(a=11, b=49)]





### æµå¼å¤„ç†

å½“åœ¨æµå¼å¤„ç†ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨å·¥å…·æ—¶ï¼Œ[æ¶ˆæ¯å—](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.ai.AIMessageChunk.html#langchain_core.messages.ai.AIMessageChunk)å°†é€šè¿‡`.tool_call_chunks`å±æ€§ä»¥åˆ—è¡¨å½¢å¼å¡«å……åŒ…å«[å·¥å…·è°ƒç”¨å—](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.tool.ToolCallChunk.html#langchain_core.messages.tool.ToolCallChunk)å¯¹è±¡çš„å†…å®¹ã€‚`ToolCallChunk`åŒ…æ‹¬ç”¨äºå·¥å…·çš„å¯é€‰å­—ç¬¦ä¸²å­—æ®µ`name`ã€`args`å’Œ`id`ï¼Œå¹¶åŒ…æ‹¬å¯é€‰çš„æ•´æ•°å­—æ®µ`index`ï¼Œå¯ç”¨äºåˆå¹¶å—ã€‚å­—æ®µæ˜¯å¯é€‰çš„ï¼Œå› ä¸ºå·¥å…·è°ƒç”¨çš„éƒ¨åˆ†å¯èƒ½åœ¨ä¸åŒçš„å—ä¸­è¿›è¡Œæµä¼ è¾“ï¼ˆä¾‹å¦‚ï¼ŒåŒ…å«å‚æ•°å­å­—ç¬¦ä¸²çš„å—å¯èƒ½å¯¹å·¥å…·åç§°å’Œidå…·æœ‰ç©ºå€¼ï¼‰ã€‚

ç”±äºæ¶ˆæ¯å—ä»å…¶çˆ¶ç±»æ¶ˆæ¯ç±»ç»§æ‰¿ï¼Œå› æ­¤å…·æœ‰å·¥å…·è°ƒç”¨å—çš„[AIMessageChunk](https://api.python.langchain.com/en/latest/messages/langchain_core.messages.ai.AIMessageChunk.html#langchain_core.messages.ai.AIMessageChunk)è¿˜å°†åŒ…æ‹¬`.tool_calls`å’Œ`.invalid_tool_calls`å­—æ®µã€‚è¿™äº›å­—æ®µæ˜¯ä»æ¶ˆæ¯çš„å·¥å…·è°ƒç”¨å—ä¸­æœ€ä½³åŠªåŠ›è§£æçš„ã€‚

è¯·æ³¨æ„ï¼Œç›®å‰å¹¶éæ‰€æœ‰æä¾›ç¨‹åºéƒ½æ”¯æŒå·¥å…·è°ƒç”¨çš„æµä¼ è¾“ã€‚

ç¤ºä¾‹ï¼š

```python
async for chunk in llm_with_tools.astream(query):
    print(chunk.tool_call_chunks)
```

    []
    [{'name': 'Multiply', 'args': '', 'id': 'call_d39MsxKM5cmeGJOoYKdGBgzc', 'index': 0}]
    [{'name': None, 'args': '{"a"', 'id': None, 'index': 0}]
    [{'name': None, 'args': ': 3, ', 'id': None, 'index': 0}]
    [{'name': None, 'args': '"b": 1', 'id': None, 'index': 0}]
    [{'name': None, 'args': '2}', 'id': None, 'index': 0}]
    [{'name': 'Add', 'args': '', 'id': 'call_QJpdxD9AehKbdXzMHxgDMMhs', 'index': 1}]
    [{'name': None, 'args': '{"a"', 'id': None, 'index': 1}]
    [{'name': None, 'args': ': 11,', 'id': None, 'index': 1}]
    [{'name': None, 'args': ' "b": ', 'id': None, 'index': 1}]
    [{'name': None, 'args': '49}', 'id': None, 'index': 1}]
    []
    

è¯·æ³¨æ„ï¼Œæ·»åŠ æ¶ˆæ¯å—å°†åˆå¹¶å®ƒä»¬å¯¹åº”çš„å·¥å…·è°ƒç”¨å—ã€‚è¿™æ˜¯LangChainçš„å„ç§[å·¥å…·è¾“å‡ºè§£æå™¨](/modules/model_io/output_parsers/types/openai_tools/)æ”¯æŒæµå¼å¤„ç†çš„åŸåˆ™ã€‚

ä¾‹å¦‚ï¼Œä¸‹é¢æˆ‘ä»¬ç´¯ç§¯å·¥å…·è°ƒç”¨å—ï¼š

```python
first = True
async for chunk in llm_with_tools.astream(query):
    if first:
        gathered = chunk
        first = False
    else:
        gathered = gathered + chunk

    print(gathered.tool_call_chunks)
```

    []
    [{'name': 'Multiply', 'args': '', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}]
    [{'name': 'Multiply', 'args': '{"a"', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}]
    [{'name': 'Multiply', 'args': '{"a": 3, ', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 1', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}, {'name': 'Add', 'args': '', 'id': 'call_tYHYdEV2YBvzDcSCiFCExNvw', 'index': 1}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}, {'name': 'Add', 'args': '{"a"', 'id': 'call_tYHYdEV2YBvzDcSCiFCExNvw', 'index': 1}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}, {'name': 'Add', 'args': '{"a": 11,', 'id': 'call_tYHYdEV2YBvzDcSCiFCExNvw', 'index': 1}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}, {'name': 'Add', 'args': '{"a": 11, "b": ', 'id': 'call_tYHYdEV2YBvzDcSCiFCExNvw', 'index': 1}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}, {'name': 'Add', 'args': '{"a": 11, "b": 49}', 'id': 'call_tYHYdEV2YBvzDcSCiFCExNvw', 'index': 1}]
    [{'name': 'Multiply', 'args': '{"a": 3, "b": 12}', 'id': 'call_erKtz8z3e681cmxYKbRof0NS', 'index': 0}, {'name': 'Add', 'args': '{"a": 11, "b": 49}', 'id': 'call_tYHYdEV2YBvzDcSCiFCExNvw', 'index': 1}]
    

```python
print(type(gathered.tool_call_chunks[0]["args"]))
```


    <class 'str'>



å¹¶ä¸”æˆ‘ä»¬ç´¯ç§¯å·¥å…·è°ƒç”¨ä»¥æ¼”ç¤ºéƒ¨åˆ†è§£æï¼š

```python
first = True
async for chunk in llm_with_tools.astream(query):
    if first:
        gathered = chunk
        first = False
    else:
        gathered = gathered + chunk

    print(gathered.tool_calls)
```

    []
    []
    [{'name': 'Multiply', 'args': {}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}]
    [{'name': 'Multiply', 'args': {'a': 3}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 1}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}, {'name': 'Add', 'args': {}, 'id': 'call_UjSHJKROSAw2BDc8cp9cSv4i'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}, {'name': 'Add', 'args': {'a': 11}, 'id': 'call_UjSHJKROSAw2BDc8cp9cSv4i'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}, {'name': 'Add', 'args': {'a': 11}, 'id': 'call_UjSHJKROSAw2BDc8cp9cSv4i'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}, {'name': 'Add', 'args': {'a': 11, 'b': 49}, 'id': 'call_UjSHJKROSAw2BDc8cp9cSv4i'}]
    [{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_BXqUtt6jYCwR1DguqpS2ehP0'}, {'name': 'Add', 'args': {'a': 11, 'b': 49}, 'id': 'call_UjSHJKROSAw2BDc8cp9cSv4i'}]
    

```python
print(type(gathered.tool_calls[0]["args"]))
```


    <class 'dict'>



## å°†å·¥å…·è¾“å‡ºä¼ é€’ç»™æ¨¡å‹

å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ¨¡å‹ç”Ÿæˆçš„å·¥å…·è°ƒç”¨æ¥å®é™…è°ƒç”¨å·¥å…·ï¼Œå¹¶å¸Œæœ›å°†å·¥å…·ç»“æœä¼ é€’å›æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨`ToolMessage`ã€‚

```python
from langchain_core.messages import HumanMessage, ToolMessage

messages = [HumanMessage(query)]
ai_msg = llm_with_tools.invoke(messages)
messages.append(ai_msg)
for tool_call in ai_msg.tool_calls:
    selected_tool = {"add": add, "multiply": multiply}[tool_call["name"].lower()]
    tool_output = selected_tool.invoke(tool_call["args"])
    messages.append(ToolMessage(tool_output, tool_call_id=tool_call["id"]))
messages
```




    [HumanMessage(content='What is 3 * 12? Also, what is 11 + 49?'),
     AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_K5DsWEmgt6D08EI9AFu9NaL1', 'function': {'arguments': '{"a": 3, "b": 12}', 'name': 'Multiply'}, 'type': 'function'}, {'id': 'call_qywVrsplg0ZMv7LHYYMjyG81', 'function': {'arguments': '{"a": 11, "b": 49}', 'name': 'Add'}, 'type': 'function'}]}, response_metadata={'token_usage': {'completion_tokens': 50, 'prompt_tokens': 105, 'total_tokens': 155}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': 'fp_b28b39ffa8', 'finish_reason': 'tool_calls', 'logprobs': None}, id='run-1a0b8cdd-9221-4d94-b2ed-5701f67ce9fe-0', tool_calls=[{'name': 'Multiply', 'args': {'a': 3, 'b': 12}, 'id': 'call_K5DsWEmgt6D08EI9AFu9NaL1'}, {'name': 'Add', 'args': {'a': 11, 'b': 49}, 'id': 'call_qywVrsplg0ZMv7LHYYMjyG81'}]),
     ToolMessage(content='36', tool_call_id='call_K5DsWEmgt6D08EI9AFu9NaL1'),
     ToolMessage(content='60', tool_call_id='call_qywVrsplg0ZMv7LHYYMjyG81')]




```python
llm_with_tools.invoke(messages)
```




    AIMessage(content='3 * 12 is 36 and 11 + 49 is 60.', response_metadata={'token_usage': {'completion_tokens': 18, 'prompt_tokens': 171, 'total_tokens': 189}, 'model_name': 'gpt-3.5-turbo', 'system_fingerprint': 'fp_b28b39ffa8', 'finish_reason': 'stop', 'logprobs': None}, id='run-a6c8093c-b16a-4c92-8308-7c9ac998118c-0')



## å°‘é‡ç¤ºä¾‹æç¤º

å¯¹äºæ›´å¤æ‚çš„å·¥å…·ä½¿ç”¨ï¼Œæ·»åŠ å°‘é‡ç¤ºä¾‹æç¤ºéå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å¸¦æœ‰`ToolCall`å’Œç›¸åº”`ToolMessage`çš„`AIMessage`æ¥å®ç°ã€‚

ä¾‹å¦‚ï¼Œå³ä½¿åœ¨ä¸€äº›ç‰¹æ®Šè¯´æ˜ä¸‹ï¼Œæˆ‘ä»¬çš„æ¨¡å‹ä¹Ÿå¯èƒ½å› ä¸ºè¿ç®—é¡ºåºè€Œå‡ºé”™ï¼š

```python
llm_with_tools.invoke(
    "Whats 119 times 8 minus 20. Don't do any math yourself, only use tools for math. Respect order of operations"
).tool_calls
```




    [{'name': 'Multiply',
      'args': {'a': 119, 'b': 8},
      'id': 'call_Dl3FXRVkQCFW4sUNYOe4rFr7'},
     {'name': 'Add',
      'args': {'a': 952, 'b': -20},
      'id': 'call_n03l4hmka7VZTCiP387Wud2C'}]



ç”±äºä¸èƒ½çŸ¥é“119 * 8çš„ç»“æœï¼Œå› æ­¤æ¨¡å‹ä¸åº”å°è¯•è¿›è¡Œä»»ä½•åŠ æ³•è¿ç®—ã€‚

é€šè¿‡æ·»åŠ ä¸€äº›ç¤ºä¾‹æç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çº æ­£è¿™ç§è¡Œä¸ºï¼š

```python
from langchain_core.messages import AIMessage
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.runnables import RunnablePassthrough

examples = [
    HumanMessage(
        "What's the product of 317253 and 128472 plus four", name="example_user"
    ),
    AIMessage(
        "",
        name="example_assistant",
        tool_calls=[
            {"name": "Multiply", "args": {"x": 317253, "y": 128472}, "id": "1"}
        ],
    ),
    ToolMessage("16505054784", tool_call_id="1"),
    AIMessage(
        "",
        name="example_assistant",
        tool_calls=[{"name": "Add", "args": {"x": 16505054784, "y": 4}, "id": "2"}],
    ),
    ToolMessage("16505054788", tool_call_id="2"),
    AIMessage(
        "The product of 317253 and 128472 plus four is 16505054788",
        name="example_assistant",
    ),
]

system = """You are bad at math but are an expert at using a calculator. 

Use past tool usage as an example of how to correctly use the tools."""
few_shot_prompt = ChatPromptTemplate.from_messages(
    [
        ("system", system),
        *examples,
        ("human", "{query}"),
    ]
)

chain = {"query": RunnablePassthrough()} | few_shot_prompt | llm_with_tools
chain.invoke("Whats 119 times 8 minus 20").tool_calls
```




    [{'name': 'Multiply',
      'args': {'a': 119, 'b': 8},
      'id': 'call_MoSgwzIhPxhclfygkYaKIsGZ'}]



çœ‹èµ·æ¥è¿™æ¬¡æˆ‘ä»¬å¾—åˆ°äº†æ­£ç¡®çš„è¾“å‡ºã€‚

ä¸‹é¢æ˜¯[LangSmithè·Ÿè¸ª](https://smith.langchain.com/public/f70550a1-585f-4c9d-a643-13148ab1616f/r)çš„æ ·å­ã€‚



## ä¸‹ä¸€æ­¥

- **è¾“å‡ºè§£æ**ï¼šè¯·æŸ¥é˜…[OpenAIå·¥å…·è¾“å‡ºè§£æå™¨](/modules/model_io/output_parsers/types/openai_tools/)å’Œ[OpenAIå‡½æ•°è¾“å‡ºè§£æå™¨](/modules/model_io/output_parsers/types/openai_functions/)ï¼Œäº†è§£å¦‚ä½•å°†å‡½æ•°è°ƒç”¨APIå“åº”æå–ä¸ºå„ç§æ ¼å¼ã€‚
- **ç»“æ„åŒ–è¾“å‡ºé“¾**ï¼š[ä¸€äº›æ¨¡å‹æœ‰æ„é€ å‡½æ•°](/modules/model_io/chat/structured_output/)ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åˆ›å»ºä¸€ä¸ªç»“æ„åŒ–è¾“å‡ºé“¾ã€‚
- **å·¥å…·ä½¿ç”¨**ï¼šæŸ¥çœ‹å¦‚ä½•æ„å»ºé“¾æ¡å’Œä»£ç†ï¼Œè°ƒç”¨[è¿™äº›æŒ‡å—ä¸­è°ƒç”¨çš„å·¥å…·](/use_cases/tool_use/)ã€‚